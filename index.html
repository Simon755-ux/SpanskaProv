<!DOCTYPE html>
<html lang="sv">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanska VerbÃ¶vningar</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 30px;
            text-align: center;
            color: white;
        }
        
        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }
        
        .screen {
            display: none;
            padding: 30px;
        }
        
        .screen.active {
            display: block;
        }
        
        .mode-selector {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }
        
        .mode-btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }
        
        .mode-btn:not(.active) {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }
        
        .mode-btn:hover:not(.active) {
            background: #667eea;
            color: white;
        }
        
        .section-list {
            display: grid;
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .section-checkbox {
            display: flex;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .section-checkbox:hover {
            background: #e9ecef;
            border-color: #667eea;
        }
        
        .section-checkbox input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
        }
        
        .section-checkbox label {
            cursor: pointer;
            flex: 1;
            font-size: 1.1em;
        }
        
        .btn {
            padding: 15px 40px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: inline-block;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(245, 87, 108, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .text-center {
            text-align: center;
        }
        
        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }
        
        .progress-text {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.1em;
            color: #666;
        }
        
        .question-section {
            font-size: 0.9em;
            color: #667eea;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .question-text {
            font-size: 1.3em;
            margin-bottom: 15px;
            color: #333;
        }
        
        .question-hint {
            color: #666;
            font-style: italic;
            margin-bottom: 20px;
        }
        
        .answer-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #ddd;
            border-radius: 10px;
            transition: border-color 0.3s;
            margin-bottom: 15px;
        }
        
        .answer-input:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .answer-input.correct {
            border-color: #28a745;
            background: #d4edda;
        }
        
        .answer-input.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }
        
        .feedback {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 1.1em;
            display: none;
        }
        
        .feedback.show {
            display: block;
        }
        
        .feedback.correct {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }
        
        .feedback.incorrect {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #dc3545;
        }
        
        .attempts {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.1em;
            color: #666;
        }
        
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .results-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .results-score {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }
        
        .results-message {
            font-size: 1.3em;
            color: #666;
            margin-bottom: 20px;
        }
        
        .results-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 10px;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        
        .stat-label {
            color: #666;
            margin-top: 5px;
        }
        
        .select-all {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .select-all button {
            margin: 0 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸ‡ªðŸ‡¸ Spanska VerbÃ¶vningar ðŸ‡ªðŸ‡¸</h1>
            <p>Reflexiva verb & Ã–versÃ¤ttningar</p>
        </div>
        
        <!-- Meny Screen -->
        <div id="menuScreen" class="screen active">
            <h2 class="text-center" style="margin-bottom: 30px; color: #667eea;">VÃ¤lj spellÃ¤ge</h2>
            <div class="mode-selector">
                <button class="mode-btn active" onclick="selectMode('verbs')">VerbbÃ¶jningar</button>
                <button class="mode-btn" onclick="selectMode('translations')">Ã–versÃ¤ttningar</button>
            </div>
        </div>
        
        <!-- Urvals Screen -->
        <div id="selectionScreen" class="screen">
            <h2 class="text-center" style="margin-bottom: 20px; color: #667eea;">VÃ¤lj Ã¶vningar</h2>
            
            <div class="select-all">
                <button class="btn btn-secondary" onclick="selectAll()">Markera alla</button>
                <button class="btn btn-secondary" onclick="deselectAll()">Avmarkera alla</button>
            </div>
            
            <div id="sectionList" class="section-list"></div>
            
            <div class="controls">
                <button class="btn btn-secondary" onclick="backToMenu()">Tillbaka</button>
                <button class="btn btn-primary" onclick="startExercise()" id="startBtn">Starta Ã¶vning</button>
            </div>
        </div>
        
        <!-- Ã–vnings Screen -->
        <div id="exerciseScreen" class="screen">
            <div class="progress-text" id="progressText"></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            
            <div class="question-card">
                <div class="question-section" id="questionSection"></div>
                <div class="question-text" id="questionText"></div>
                <div class="question-hint" id="questionHint"></div>
                
                <div class="attempts" id="attemptsText"></div>
                
                <input type="text" class="answer-input" id="answerInput" placeholder="Skriv ditt svar hÃ¤r...">
                
                <div class="feedback" id="feedback"></div>
                
                <div class="controls">
                    <button class="btn btn-primary" onclick="checkAnswer()" id="checkBtn">Kontrollera</button>
                    <button class="btn btn-primary" onclick="nextQuestion()" id="nextBtn" style="display: none;">NÃ¤sta</button>
                </div>
            </div>
        </div>
        
        <!-- Resultat Screen -->
        <div id="resultsScreen" class="screen">
            <div class="results-card">
                <div class="results-score" id="resultsScore"></div>
                <div class="results-message" id="resultsMessage"></div>
                
                <div class="results-stats">
                    <div class="stat-box">
                        <div class="stat-number" id="totalQuestions">0</div>
                        <div class="stat-label">Totalt frÃ¥gor</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="correctAnswers">0</div>
                        <div class="stat-label">RÃ¤tt</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="wrongAnswers">0</div>
                        <div class="stat-label">Fel</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="firstTryCorrect">0</div>
                        <div class="stat-label">RÃ¤tt fÃ¶rsta gÃ¥ngen</div>
                    </div>
                </div>
            </div>
            
            <div class="controls">
                <button class="btn btn-secondary" onclick="backToMenu()">Meny</button>
                <button class="btn btn-primary" onclick="restartAll()">Starta om alla</button>
                <button class="btn btn-primary" onclick="restartWrong()" id="restartWrongBtn">Starta om felen</button>
            </div>
        </div>
    </div>

    <script>
        let currentMode = 'verbs';
        let selectedSections = [];
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let attempts = 0;
        let stats = {
            total: 0,
            correct: 0,
            wrong: 0,
            firstTry: 0,
            wrongQuestions: []
        };
        
        const verbExercises = [
            {
                id: 'presens1',
                title: "Presens - Nutid (Set 1)",
                questions: [
                    { q: "Mis amigos _____ un libro.", hint: "(skriva)", answer: "escriben" },
                    { q: "Yo _____ en la escuela.", hint: "(lÃ¤ra sig)", answer: "aprendo" },
                    { q: "Vosotros _____ a EspaÃ±a.", hint: "(Ã¥ka)", answer: "vais" },
                    { q: "Por quÃ© no _____ ustedes?", hint: "(Ã¤ta)", answer: "comen" },
                    { q: "Ana y yo _____ el texto.", hint: "(lÃ¤sa)", answer: "leemos" },
                    { q: "Los niÃ±os _____ mucho.", hint: "(frÃ¥ga)", answer: "preguntan" },
                    { q: "Â¿QuÃ© _____ tÃº?", hint: "(sÃ¤ga)", answer: "dices" },
                    { q: "Yo _____ la ciudad.", hint: "(kÃ¤nna till)", answer: "conozco" }
                ]
            },
            {
                id: 'reflexiva',
                title: "Reflexiva verb - Presens",
                questions: [
                    { q: "Mis padres _____ a las seis.", hint: "(stiga upp)", answer: "se levantan" },
                    { q: "TÃº _____ muy tarde.", hint: "(lÃ¤gga sig)", answer: "te acuestas" },
                    { q: "Laura y yo _____.", hint: "(tvÃ¤tta sig)", answer: "nos lavamos" },
                    { q: "Yo _____ la ropa.", hint: "(sÃ¤tta pÃ¥ sig)", answer: "me pongo" },
                    { q: "Felipe _____ todos los dÃ­as.", hint: "(duscha)", answer: "se ducha" },
                    { q: "Ellos _____ siempre.", hint: "(kamma sig)", answer: "se peinan" },
                    { q: "Usted _____ mucho.", hint: "(sminka sig)", answer: "se maquilla" },
                    { q: "La chica _____ MarÃ­a.", hint: "(heta)", answer: "se llama" },
                    { q: "Yo _____ en casa.", hint: "(stanna kvar)", answer: "me quedo" }
                ]
            },
            {
                id: 'diftong',
                title: "Presens - Diftongerande verb",
                questions: [
                    { q: "Yo _____ en la escuela.", hint: "(tÃ¤nka)", answer: "pienso" },
                    { q: "MarÃ­a y tÃº _____ al tenis.", hint: "(spela)", answer: "jugÃ¡is" },
                    { q: "TÃº _____ todo el dÃ­a.", hint: "(sova)", answer: "duermes" },
                    { q: "Vosotras _____ tarde.", hint: "(bÃ¶rja)", answer: "empezÃ¡is" },
                    { q: "TÃº y yo _____ la puerta.", hint: "(stÃ¤nga)", answer: "cerramos" },
                    { q: "Pablo _____ la mÃºsica pop.", hint: "(fÃ¶redra)", answer: "prefiere" },
                    { q: "Usted _____ estudiar mucho.", hint: "(bruka)", answer: "suele" },
                    { q: "Nosotros _____ hablar maÃ±ana.", hint: "(kunna)", answer: "podemos" }
                ]
            },
            {
                id: 'perfekt1',
                title: "Perfekt - DÃ¥tid",
                questions: [
                    { q: "TÃº _____ la tele, Â¿no?", hint: "(se)", answer: "has visto" },
                    { q: "Pedro _____ muchas novelas.", hint: "(lÃ¤sa)", answer: "ha leÃ­do" },
                    { q: "Yo _____ en casa.", hint: "(vÃ¤nta)", answer: "he esperado" },
                    { q: "Ustedes _____ mucho chocolate.", hint: "(kÃ¶pa)", answer: "han comprado" },
                    { q: "Carmen _____ cada noche.", hint: "(gÃ¥ ut)", answer: "ha salido" },
                    { q: "Vosotros _____ un libro.", hint: "(skriva)", answer: "habÃ©is escrito" },
                    { q: "Las chicas _____ a Madrid.", hint: "(Ã¥ka)", answer: "han ido" },
                    { q: "Alberto y yo _____ suerte.", hint: "(ha)", answer: "hemos tenido" },
                    { q: "Â¿QuÃ© _____ los niÃ±os?", hint: "(gÃ¶ra)", answer: "han hecho" }
                ]
            },
            {
                id: 'futurum1',
                title: "Futurum - Framtid",
                questions: [
                    { q: "El hombre _____ sueco.", hint: "(lyssna)", answer: "va a escuchar" },
                    { q: "Mi amigo y yo _____ tarde.", hint: "(Ã¥tervÃ¤nda)", answer: "vamos a volver" },
                    { q: "La profesora _____ la puerta.", hint: "(stÃ¤nga)", answer: "va a cerrar" },
                    { q: "Ustedes _____ ahora.", hint: "(gÃ¥ ut)", answer: "van a salir" },
                    { q: "Yo _____ una montaÃ±a.", hint: "(gÃ¥ upp)", answer: "voy a subir" }
                ]
            },
            {
                id: 'gerundium1',
                title: "Gerundium - PÃ¥gÃ¥endeform",
                questions: [
                    { q: "Usted _____ mucho.", hint: "(arbeta)", answer: "estÃ¡ trabajando" },
                    { q: "TÃº _____ agua.", hint: "(dricka)", answer: "estÃ¡s bebiendo" },
                    { q: "Las chicas _____ algo.", hint: "(fÃ¶rklara)", answer: "estÃ¡n explicando" },
                    { q: "Â¿QuÃ© _____ ustedes?", hint: "(gÃ¶ra)", answer: "estÃ¡n haciendo" },
                    { q: "Yo _____ en un hotel.", hint: "(bo)", answer: "estoy viviendo" },
                    { q: "Ã‰l _____ mucho.", hint: "(fÃ¶rstÃ¥)", answer: "estÃ¡ entendiendo/estÃ¡ comprendiendo" },
                    { q: "Nosotros _____ fÃºtbol.", hint: "(trÃ¤na)", answer: "estamos entrenando" }
                ]
            }
        ];
        
        const translationExercises = [
            {
                id: 'translations1',
                title: "Ã–versÃ¤ttningar - Del 1 (meningar 1-10)",
                questions: [
                    { q: "Jag tvÃ¤ttar mig och du kammar dig.", answer: "(Yo) me lavo y (tÃº) te peinas" },
                    { q: "Vilken tid stiger ni upp pÃ¥ morgonen?", answer: "Â¿A quÃ© hora os levantÃ¡is por la maÃ±ana?" },
                    { q: "Hon sminkar sig och de duschar.", answer: "(Ella) se maquilla y (ellos) se duchan." },
                    { q: "Du stannar kvar men jag lÃ¤gger mig.", answer: "(TÃº) te quedas pero (yo) me acuesto." },
                    { q: "Hur mycket tid behÃ¶ver vi hemma?", answer: "Â¿CuÃ¡nto tiempo necesitamos en casa?" },
                    { q: "Ibland gÃ¶r jag lÃ¤xorna ocksÃ¥.", answer: "A veces hago los deberes tambiÃ©n." },
                    { q: "KÃ¤ra Pedro, det var lÃ¤nge sedan!", answer: "Querido Pedro, Â¡cuÃ¡nto tiempo sin verte!" },
                    { q: "Vi har lÃ¤st en roman, som tur Ã¤r.", answer: "Hemos leÃ­do una novela, por suerte." },
                    { q: "Hur mÃ¥nga gÃ¥nger ska hon Ã¥tervÃ¤nda till Centralamerika?", answer: "Â¿CuÃ¡ntas veces va a volver a AmÃ©rica Central?" },
                    { q: "Barnen pÃ¥ fÃ¶rskolan gÃ¶r en utflykt till djungeln.", answer: "Los niÃ±os en el preescolar hacen una excursiÃ³n a la selva tropical." }
                ]
            },
            {
                id: 'translations2',
                title: "Ã–versÃ¤ttningar - Del 2 (meningar 11-20)",
                questions: [
                    { q: "Ska du gÃ¥ till fots eller ska du rida till turistbyrÃ¥n?", answer: "Â¿Vas a ir a pie o vas a montar a caballo a la agencia de turismo?" },
                    { q: "Aporna har varit mycket vÃ¤nliga.", answer: "Los monos han sido/estado muy amables./Los monos han sido muy amables./Los monos han estado muy amables." },
                    { q: "Jag har sett Stilla Havet, och imorgon ska jag se Karibiska Havet.", answer: "He visto el OcÃ©ano PacÃ­fico, y maÃ±ana voy a ver el Mar Caribe." },
                    { q: "Nicaragua Ã¤r det stÃ¶rsta landet i Centralamerika.", answer: "Nicaragua es el paÃ­s mÃ¡s grande de AmÃ©rica Central." },
                    { q: "LÃ¤nderna Ã¤r olika, men ocksÃ¥ lika.", answer: "Los paÃ­ses son diferentes, pero tambiÃ©n parecidos." },
                    { q: "De exporterar framfÃ¶r allt bananer.", answer: "Exportan sobre todo plÃ¡tanos." },
                    { q: "Vi bor i en liten stad som heter Matagalpa.", answer: "Vivimos en una ciudad pequeÃ±a que se llama Matagalpa." },
                    { q: "Majoriteten av befolkningen lever av jordbruket.", answer: "La mayorÃ­a de la poblaciÃ³n vive/viven de la agricultura./La mayorÃ­a de la poblaciÃ³n vive de la agricultura./La mayorÃ­a de la poblaciÃ³n viven de la agricultura." },
                    { q: "De behÃ¶ver kÃ¶pa kaffe i matsalen.", answer: "Necesitan comprar cafÃ© en el comedor." },
                    { q: "Jag kan prata lite svenska.", answer: "Puedo hablar un poco de sueco." }
                ]
            }
        ];
        
        function selectMode(mode) {
            currentMode = mode;
            document.querySelectorAll('.mode-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }
        
        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => screen.classList.remove('active'));
            document.getElementById(screenId).classList.add('active');
        }
        
        function backToMenu() {
            showScreen('menuScreen');
            resetStats();
        }
        
        function selectAll() {
            document.querySelectorAll('#sectionList input[type="checkbox"]').forEach(cb => cb.checked = true);
        }
        
        function deselectAll() {
            document.querySelectorAll('#sectionList input[type="checkbox"]').forEach(cb => cb.checked = false);
        }
        
        function loadSections() {
            const sections = currentMode === 'verbs' ? verbExercises : translationExercises;
            const listContainer = document.getElementById('sectionList');
            listContainer.innerHTML = '';
            
            sections.forEach(section => {
                const div = document.createElement('div');
                div.className = 'section-checkbox';
                div.innerHTML = `
                    <input type="checkbox" id="section-${section.id}" value="${section.id}">
                    <label for="section-${section.id}">${section.title} (${section.questions.length} frÃ¥gor)</label>
                `;
                listContainer.appendChild(div);
            });
        }
        
        document.querySelectorAll('.mode-btn')[0].addEventListener('click', function() {
            loadSections();
            showScreen('selectionScreen');
        });
        
        document.querySelectorAll('.mode-btn')[1].addEventListener('click', function() {
            loadSections();
            showScreen('selectionScreen');
        });
        
        function startExercise() {
            const checkboxes = document.querySelectorAll('#sectionList input[type="checkbox"]:checked');
            
            if (checkboxes.length === 0) {
                alert('VÃ¤lj minst en Ã¶vningssektion!');
                return;
            }
            
            selectedSections = Array.from(checkboxes).map(cb => cb.value);
            
            currentQuestions = [];
            const sections = currentMode === 'verbs' ? verbExercises : translationExercises;
            
            sections.forEach(section => {
                if (selectedSections.includes(section.id)) {
                    section.questions.forEach(q => {
                        currentQuestions.push({
                            ...q,
                            sectionTitle: section.title
                        });
                    });
                }
            });
            
            currentQuestionIndex = 0;
            resetStats();
            stats.total = currentQuestions.length;
            
            showScreen('exerciseScreen');
            loadQuestion();
        }
        
        function resetStats() {
            stats = {
                total: 0,
                correct: 0,
                wrong: 0,
                firstTry: 0,
                wrongQuestions: []
            };
        }
        
        function loadQuestion() {
            if (currentQuestionIndex >= currentQuestions.length) {
                showResults();
                return;
            }
            
            const question = currentQuestions[currentQuestionIndex];
            attempts = 0;
            
            document.getElementById('progressText').textContent = 
                `FrÃ¥ga ${currentQuestionIndex + 1} av ${currentQuestions.length}`;
            document.getElementById('progressFill').style.width = 
                `${((currentQuestionIndex) / currentQuestions.length) * 100}%`;
            
            document.getElementById('questionSection').textContent = question.sectionTitle;
            document.getElementById('questionText').textContent = question.q;
            document.getElementById('questionHint').textContent = question.hint || '';
            document.getElementById('questionHint').style.display = question.hint ? 'block' : 'none';
            
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').className = 'answer-input';
            document.getElementById('answerInput').disabled = false;
            document.getElementById('answerInput').focus();
            
            document.getElementById('feedback').className = 'feedback';
            document.getElementById('attemptsText').textContent = 'FÃ¶rsÃ¶k 1 av 2';
            
            document.getElementById('checkBtn').style.display = 'inline-block';
            document.getElementById('nextBtn').style.display = 'none';
        }
        
        function normalizeText(text) {
            return text.toLowerCase()
                .trim()
                .replace(/\s+/g, ' ')
                .replace(/[Â¿?Â¡!.]/g, '')
                .replace(/\(yo\)/g, '')
                .replace(/\(tÃº\)/g, '')
                .replace(/\(ella\)/g, '')
                .replace(/\(ellos\)/g, '')
                .replace(/\(/g, '')
                .replace(/\)/g, '');
        }
        
        function checkAnswer() {
            attempts++;
            
            const userAnswer = normalizeText(document.getElementById('answerInput').value);
            const question = currentQuestions[currentQuestionIndex];
            const correctAnswers = question.answer.toLowerCase().split('/').map(a => normalizeText(a));
            
            const isCorrect = correctAnswers.some(answer => userAnswer === answer);
            
            if (isCorrect) {
                document.getElementById('answerInput').className = 'answer-input correct';
                document.getElementById('feedback').className = 'feedback correct show';
                document.getElementById('feedback').innerHTML = 'âœ“ <strong>RÃ¤tt!</strong> Bra jobbat!';
                
                stats.correct++;
                if (attempts === 1) {
                    stats.firstTry++;
                }
                
                document.getElementById('checkBtn').style.display = 'none';
                document.getElementById('nextBtn').style.display = 'inline-block';
                document.getElementById('answerInput').disabled = true;
            } else {
                if (attempts >= 2) {
                    document.getElementById('answerInput').className = 'answer-input incorrect';
                    document.getElementById('feedback').className = 'feedback incorrect show';
                    document.getElementById('feedback').innerHTML = 
                        `âœ— <strong>TyvÃ¤rr!</strong><br>RÃ¤tt svar: <strong>${question.answer}</strong>`;
                    
                    stats.wrong++;
                    stats.wrongQuestions.push({...question, index: currentQuestionIndex});
                    
                    document.getElementById('checkBtn').style.display = 'none';
                    document.getElementById('nextBtn').style.display = 'inline-block';
                    document.getElementById('answerInput').disabled = true;
                } else {
                    document.getElementById('answerInput').className = 'answer-input incorrect';
                    document.getElementById('feedback').className = 'feedback incorrect show';
                    document.getElementById('feedback').innerHTML = 'âœ— <strong>Fel svar.</strong> FÃ¶rsÃ¶k igen!';
                    document.getElementById('attemptsText').textContent = 'FÃ¶rsÃ¶k 2 av 2';
                    document.getElementById('answerInput').select();
                }
            }
        }
        
        function nextQuestion() {
            currentQuestionIndex++;
            loadQuestion();
        }
        
        function showResults() {
            const percentage = Math.round((stats.correct / stats.total) * 100);
            
            document.getElementById('resultsScore').textContent = `${percentage}%`;
            
            let message = '';
            if (percentage === 100) {
                message = 'ðŸŽ‰ Perfekt! Du Ã¤r en stjÃ¤rna!';
            } else if (percentage >= 80) {
                message = 'ðŸ‘ Bra jobbat! FortsÃ¤tt sÃ¥!';
            } else if (percentage >= 60) {
                message = 'ðŸ’ª Du Ã¤r pÃ¥ rÃ¤tt vÃ¤g!';
            } else {
                message = 'ðŸ“š FortsÃ¤tt Ã¶va sÃ¥ blir det bÃ¤ttre!';
            }
            document.getElementById('resultsMessage').textContent = message;
            
            document.getElementById('totalQuestions').textContent = stats.total;
            document.getElementById('correctAnswers').textContent = stats.correct;
            document.getElementById('wrongAnswers').textContent = stats.wrong;
            document.getElementById('firstTryCorrect').textContent = stats.firstTry;
            
            const restartWrongBtn = document.getElementById('restartWrongBtn');
            if (stats.wrongQuestions.length > 0) {
                restartWrongBtn.style.display = 'inline-block';
            } else {
                restartWrongBtn.style.display = 'none';
            }
            
            showScreen('resultsScreen');
        }
        
        function restartAll() {
            startExercise();
        }
        
        function restartWrong() {
            if (stats.wrongQuestions.length === 0) {
                alert('Inga fel att Ã¶va pÃ¥!');
                return;
            }
            
            currentQuestions = [...stats.wrongQuestions];
            currentQuestionIndex = 0;
            resetStats();
            stats.total = currentQuestions.length;
            
            showScreen('exerciseScreen');
            loadQuestion();
        }
        
        document.getElementById('answerInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (document.getElementById('checkBtn').style.display !== 'none') {
                    checkAnswer();
                } else {
                    nextQuestion();
                }
            }
        });
        
        // Initialize mode buttons with proper event listeners
        document.querySelectorAll('.mode-btn').forEach((btn, index) => {
            btn.addEventListener('click', function() {
                selectMode(index === 0 ? 'verbs' : 'translations');
                loadSections();
                showScreen('selectionScreen');
            });
        });
    </script>
</body>
</html>
